<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    {include file="common/common_css"}

    <title>添加账号</title>
</head>

<body>
    账号
    <input type="text" id="username">
    密码
    <input type="text" id="password">
    <br>
    {volist name="$menu" id="it"}
    {$it.name}<br>
    {volist name="$it.child" id="ch"}
    &nbsp;&nbsp;&nbsp;&nbsp;
    <input type="checkbox" name="per" value="{$ch.ID}" id="{$ch.name}">
    {$ch.name}
    {/volist}
    <br>
    {/volist}
    <button onclick="register()">确认</button>

    {include file="common/common_script"}
    <!--请在下方写此页面业务相关的脚本-->
    <script type="text/javascript" src="__STATIC__/lib/My97DatePicker/4.8/WdatePicker.js"></script>
    <script type="text/javascript" src="__STATIC__/lib/datatables/1.10.0/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="__STATIC__/lib/laypage/1.2/laypage.js"></script>
    <script type="text/javascript">
        function register() {
            swal({
                title: '正在执行',
                allowOutsideClick: false,
                showCancelButton: false,
                showConfirmButton: false,
                onOpen: () => {
                    swal.showLoading()
                }
            })
            boxes = $('input:checkbox[name="per"]:checked');
            choosen_permission = [];
            for(i in boxes){
                choosen_permission.push(boxes[i].value);
            }
            username = $("#username").val();
            password = $("#password").val();
            if(username != '' && password != ''){
                $.post("__ROOT__/index.php/api/Admin/add", {
                        username: username,
                        password: password,
                        permission:choosen_permission
            }).done((res)=>{
                parent.location.reload()
                var index = parent.layer.getFrameIndex(window.name);
                    parent.layer.close(index);
            })
            }else{
                swal("","用户名或密码不能为空",'error');
            }
            
        }
    </script>
</body>

</html>